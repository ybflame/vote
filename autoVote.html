<html>
<body onload="onLoad()" style="font-size: 24px; color:black; margin:12px;">

<button style="font-size: 100px; padding:12px; margin-bottom:12px;" onclick="vote()">Vote</button>

<div>
    <h3>voted TV:</h3>
    <p id="votedTele"></p>
    <h3>TV Rankings:</h3>
    <p id="teleRank"></p>
</div>
<div>
    <h3>voted films :</h3>
    <p id="votedFilm"></p>
    <h3>Film Rankings:</h3>
    <p id="filmRank"></p>
</div>

<script type="text/javascript" src="https://static.m1905.cn/??https/2020lpstop/js/common.js,js/core/jquery-edge.min.js,https/2020lpstop/js/wxShare.js,https/2022lpstop/js/index.min.js"></script>
<script>
    var top5Tele = "filmlist=52,53,54,55,92"; 
    var top5Film = "2,4,6,16,48";
    var bottom5Tele = "";
    var bottom5Film = "";

    function vote() {
        //var Ai = "filmlist=54,54,54,54,54,54,54,16,16,16,16,16,16,16,48,48,48,48,48,48"; 
        var Ai = top5Tele + "," + bottom5Tele + "," + top5Film + "," + bottom5Film;
        console.log("ai", Ai);
        clearResult();
        $.ajax({
            url: "https://promotion.1905.com/Lottery/?m=Bluefilm&a=createfilmtele2021",
            data: Ai,
            type: "GET",
            dataType: "jsonp",
            success: function(i) {
                var Aj = i;
                if (Aj.status == "200") {
                    getDataFn();
                }
            },
        });
    }

    function getDataFn() {
        $.ajax({
            url: "https://promotion.1905.com/Lottery/?m=Bluefilm&a=BlueFilmHitsRank",
            dataType: "jsonp",
            type: "get",
            success: function(A) {
                console.log("A", A);
                var votedFilm = A.data.film.filter(function(a) {
                    return (a.filmid == 16 || a.filmid == 48);
                });
                $("#votedFilm").html(JSON.stringify(votedFilm));
                
                var sortedFilm = A.data.film.sort(function(a,b) {
                    return b.total - a.total;
                });
                var bottom5FilmArr = sortedFilm.slice(-5);
                bottom5Film = bottom5FilmArr.map(function(a) {
                    return a.filmid;
                }).join(",");
                console.log("bottom5Film", bottom5FilmArr);

                $("#filmRank").html(JSON.stringify(sortedFilm));


                var votedTele = A.data.tele.filter(function(a) {
                    return (a.filmid == 54);
                });
                $("#votedTele").html(JSON.stringify(votedTele));
                
                var sortedTele = A.data.tele.sort(function(a,b) {
                    return b.total - a.total;
                });

                var bottom5TeleArr = sortedTele.slice(-5);
                bottom5Tele = bottom5TeleArr.map(function(a) {
                    return a.filmid;
                }).join(",");
                console.log("bottom5Tele", bottom5TeleArr);


                $("#teleRank").html(JSON.stringify(sortedTele));
            }
        });

    }

    function onLoad() {
        getDataFn();
        setInterval(vote, 20000);
    }

    function clearResult() {
        $("#votedFilm").html('');
        $("#filmRank").html('');
        $("#votedTele").html('');
        $("#teleRank").html('');
    }
</script>
</body>
</html>